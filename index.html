<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time ISS tracking with beautiful 3D solar system visualization">

    <!-- FORCE NO CACHE - NUCLEAR OPTION -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>Real-Time ISS & Solar System Visualization</title>

    <!-- Styles -->
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/ui.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <h1>üöÄ ISS Tracker</h1>
            <div class="loading-spinner"></div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text">
                    <span id="progress-percent">0%</span>
                </div>
            </div>
            <p id="loading-status">Initializing solar system...</p>
        </div>
    </div>

    <!-- Main 3D Canvas Container -->
    <div id="canvas-container"></div>

    <!-- UI Overlay -->
    <div id="ui-overlay">
        <!-- Header with Title and FPS -->
        <div id="header">
            <h1>üåç Real-Time ISS Tracker</h1>
            <div id="fps-counter">FPS: --</div>
        </div>

        <!-- Control Panel -->
        <div id="control-panel" class="panel">
            <h3>Controls</h3>

            <!-- Time Speed Slider -->
            <div class="control-group">
                <label for="time-speed">Time Speed: <span id="speed-value">100000x</span></label>
                <input type="range" id="time-speed" min="1" max="500000" value="100000" step="1">
                <div class="preset-speeds">
                    <button data-speed="1">1x Real-Time</button>
                    <button data-speed="1000">1kx</button>
                    <button data-speed="10000">10kx</button>
                    <button data-speed="100000">100kx</button>
                    <button data-speed="500000">500kx</button>
                </div>
            </div>

            <!-- Play/Pause -->
            <div class="control-group">
                <button id="play-pause" class="btn-primary">‚è∏ Pause</button>
                <button id="reset-camera" class="btn-secondary">üé• Reset Camera</button>
            </div>

            <!-- Real-Time View Button -->
            <div class="control-group">
                <button id="realtime-view-btn" class="btn-primary" style="width: 100%;">
                    üåé Real-Time View (Current Positions)
                </button>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
                    Shows actual planet positions right now
                </p>
            </div>

            <!-- Visual Style Switcher -->
            <div class="control-group">
                <label>Visual Style:</label>
                <div class="style-buttons">
                    <button data-style="realistic" class="style-btn active">üåé Realistic</button>
                    <button data-style="cartoon" class="style-btn">üé® Cartoon</button>
                    <button data-style="neon" class="style-btn">‚ö° Neon</button>
                    <button data-style="minimalist" class="style-btn">‚óØ Minimal</button>
                </div>
            </div>

            <!-- Planet Size Mode -->
            <div class="control-group">
                <label>Planet Sizes:</label>
                <div class="size-mode-buttons">
                    <label class="size-mode-btn active">
                        <input type="radio" name="size-mode" value="enlarged" checked>
                        <span>üìè Enlarged (Visible)</span>
                    </label>
                    <label class="size-mode-btn">
                        <input type="radio" name="size-mode" value="real">
                        <span>üî¨ Real Proportions</span>
                    </label>
                </div>
                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-top: 0.5rem;">
                    Real mode shows accurate size ratios. Sun is huge, planets are small. Zoom in to see details!
                </p>
            </div>

            <!-- Performance Slider -->
            <div class="control-group">
                <label for="performance-slider">Performance: <span id="performance-value">Medium (50%)</span></label>
                <input type="range" id="performance-slider" min="0" max="100" value="50" step="1">
                <div class="performance-markers">
                    <span>üêå Ultra Low</span>
                    <span>‚ö° Balanced</span>
                    <span>‚ú® Ultra High</span>
                </div>
                <p class="preset-description" id="preset-description">
                    Drag slider left for smoothness, right for quality
                </p>
            </div>

            <!-- Shooting Star Frequency -->
            <div class="control-group">
                <label for="meteor-frequency">Meteor Frequency: <span id="meteor-frequency-value">Low</span></label>
                <input type="range" id="meteor-frequency" min="0" max="100" value="20" step="1">
                <div class="performance-markers">
                    <span>Off</span>
                    <span>Moderate</span>
                    <span>üå† Frequent</span>
                </div>
                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-top: 0.5rem;">
                    Control how often shooting stars appear (scales with time speed)
                </p>
            </div>

            <!-- Feature Toggles -->
            <div class="control-group">
                <label>Display:</label>
                <div class="toggles">
                    <label class="toggle">
                        <input type="checkbox" id="toggle-orbits" checked>
                        <span>Orbits</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-labels" checked>
                        <span>Labels</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-trails" checked>
                        <span>Trails</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-stars" checked>
                        <span>Stars</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-asteroid-belt" checked>
                        <span>Asteroids</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-orbital-markers">
                        <span>üéØ Perihelion/Aphelion</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-sounds">
                        <span>üîä Sounds</span>
                    </label>
                </div>
                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-top: 0.5rem;">
                    Visualization uses real NASA orbital data with elliptical paths and orbital inclinations
                </p>
            </div>
        </div>

        <!-- Info Panel -->
        <div id="info-panel" class="panel">
            <h3>üõ∞Ô∏è ISS Status</h3>
            <div id="iss-info">
                <div class="info-row">
                    <span class="info-label">Position:</span>
                    <span id="iss-position">Loading...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Altitude:</span>
                    <span id="iss-altitude">-- km</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Velocity:</span>
                    <span id="iss-velocity">-- km/h</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Last Update:</span>
                    <span id="iss-update-time">--</span>
                </div>
            </div>

            <h3>üìç Selected Object</h3>
            <div class="object-selector">
                <label for="object-dropdown">Quick Select:</label>
                <select id="object-dropdown">
                    <option value="">-- Select Object --</option>
                    <option value="sun">‚òÄÔ∏è Sun</option>
                    <option value="mercury">‚òøÔ∏è Mercury</option>
                    <option value="venus">‚ôÄÔ∏è Venus</option>
                    <optgroup label="üåç Earth System">
                        <option value="earth">üåç Earth</option>
                        <option value="moon">üåô Moon</option>
                        <option value="iss">üõ∞Ô∏è ISS</option>
                    </optgroup>
                    <option value="mars">‚ôÇÔ∏è Mars</option>
                    <optgroup label="‚ôÉ Jupiter System">
                        <option value="jupiter">‚ôÉ Jupiter</option>
                        <option value="io">üåã Io</option>
                        <option value="europa">‚ùÑÔ∏è Europa</option>
                        <option value="ganymede">üåë Ganymede</option>
                        <option value="callisto">üåë Callisto</option>
                    </optgroup>
                    <optgroup label="‚ôÑ Saturn System">
                        <option value="saturn">‚ôÑ Saturn</option>
                        <option value="titan">üü† Titan</option>
                        <option value="rhea">‚ö™ Rhea</option>
                        <option value="iapetus">‚ö´ Iapetus</option>
                    </optgroup>
                    <option value="uranus">‚õ¢ Uranus</option>
                    <option value="neptune">‚ôÜ Neptune</option>
                </select>
            </div>
            <div id="selected-info">
                <p>Click any object or use dropdown to see details</p>
            </div>
        </div>

        <!-- Help Button -->
        <button id="help-button" class="floating-btn" title="Help & Controls">
            ‚ùì
        </button>

        <!-- Screenshot Button -->
        <button id="screenshot-button" title="Take Screenshot (P)">
            üì∏
        </button>

        <!-- Share Button -->
        <button id="share-button" title="Share Current View">
            üîó
        </button>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>üéÆ Controls & Help</h2>

            <h3>Camera Controls</h3>
            <ul>
                <li><strong>Left Click + Drag:</strong> Rotate camera</li>
                <li><strong>Right Click + Drag:</strong> Pan camera</li>
                <li><strong>Scroll Wheel:</strong> Zoom in/out</li>
                <li><strong>Touch:</strong> One finger rotate, two finger zoom/pan</li>
            </ul>

            <h3>Interactions</h3>
            <ul>
                <li><strong>Click Objects:</strong> Focus camera on planets or ISS</li>
                <li><strong>Time Speed:</strong> Adjust how fast time moves (1x to 50,000x)</li>
                <li><strong>Visual Styles:</strong> Switch between 4 different visual themes</li>
                <li><strong>Toggles:</strong> Show/hide orbits, labels, trails, and stars</li>
            </ul>

            <h3>Keyboard Shortcuts</h3>
            <ul>
                <li><strong>Space:</strong> Play/Pause</li>
                <li><strong>R:</strong> Reset Camera</li>
                <li><strong>H or ?:</strong> Toggle Help</li>
                <li><strong>F:</strong> Focus on Earth</li>
                <li><strong>I:</strong> Focus on ISS</li>
                <li><strong>O/L/T/S:</strong> Toggle Orbits/Labels/Trails/Stars</li>
                <li><strong>1-4:</strong> Switch Visual Styles</li>
                <li><strong>Arrow Keys:</strong> Adjust Time Speed</li>
            </ul>

            <h3>Tips</h3>
            <ul>
                <li>Try <strong>2000x speed</strong> to see Earth complete an orbit in ~7 minutes</li>
                <li>Use <strong>Neon style</strong> for dramatic orbital trails</li>
                <li>Click <strong>Earth</strong> and zoom in to see the ISS orbit</li>
                <li>At high speeds, the ISS becomes a ring around Earth</li>
            </ul>

            <h3>About</h3>
            <p>This visualization uses real-time ISS position data from Open Notify API, updated every 5 seconds. The solar system uses simplified orbital mechanics for performance.</p>

            <button id="restart-tutorial-btn" class="btn-primary" style="margin-top: 1rem; width: 100%;">
                üéì Restart Tutorial
            </button>
        </div>
    </div>

    <!-- VERSION 20250113004 - SWAPPED BUTTON VALUES -->

    <!-- Import Map for ES6 Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js"
        }
    }
    </script>

    <!-- Load Three.js from CDN (using known working version) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- ONLY LOAD TRACKBALLCONTROLS - NO ORBITCONTROLS (conflict removed) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TrackballControls.js"></script>

    <!-- Load GLTFLoader for 3D models -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <!-- Verify Three.js loaded and make it globally available -->
    <script>
        console.log('üö®üö®üö® VERIFICATION SCRIPT RUNNING - VERSION 20250113004 üö®üö®üö®');

        if (typeof THREE !== 'undefined') {
            window.THREE = THREE;
            console.log('‚úÖ Three.js library loaded (version:', THREE.REVISION, ')');

            // Verify TrackballControls loaded
            if (THREE.TrackballControls) {
                console.log('‚úÖ‚úÖ‚úÖ TrackballControls loaded - UNLIMITED ROTATION ENABLED!');
            } else {
                console.error('‚ùå‚ùå‚ùå TrackballControls FAILED TO LOAD - rotation will be broken!');
            }

            // Verify GLTFLoader loaded
            if (THREE.GLTFLoader) {
                console.log('‚úÖ GLTFLoader loaded - 3D models ready!');
            } else {
                console.error('‚ùå GLTFLoader failed to load');
            }
        } else {
            console.error('‚ùå Failed to load Three.js from CDN');
            alert('Failed to load Three.js library. Please check your internet connection and refresh the page.');
        }
    </script>

    <!-- Main Application Entry Point (will load other modules as needed) -->
    <script type="module" src="src/main.js?v=20250113004"></script>

    <!-- EMERGENCY INLINE ISS CHASE CAMERA - BYPASS MODULE CACHE -->
    <script>
        console.log('üö®üö®üö® INLINE EMERGENCY ISS CHASE SETUP LOADED üö®üö®üö®');

        // Wait for page to fully load
        window.addEventListener('load', () => {
            console.log('üö® PAGE LOADED - SETTING UP ISS CHASE BUTTON');

            setTimeout(() => {
                const issChaseBtn = document.getElementById('iss-chase-camera');
                console.log('üîç ISS Chase Button found?', issChaseBtn);

                if (issChaseBtn) {
                    console.log('‚úÖ‚úÖ‚úÖ ISS CHASE BUTTON FOUND IN INLINE SCRIPT!');

                    issChaseBtn.addEventListener('click', function(e) {
                        console.log('üö®üö®üö® ISS CHASE BUTTON CLICKED (INLINE)!!!');
                        e.preventDefault();
                        e.stopPropagation();

                        // Debug what's available
                        console.log('  typeof window.activateISSChaseCamera:', typeof window.activateISSChaseCamera);
                        console.log('  window.activateISSChaseCamera:', window.activateISSChaseCamera);

                        // Try to call the globally exposed function
                        if (typeof window.activateISSChaseCamera === 'function') {
                            console.log('‚úÖ Calling window.activateISSChaseCamera NOW!');
                            try {
                                window.activateISSChaseCamera();
                            } catch (err) {
                                console.error('‚ùå Error calling activateISSChaseCamera:', err);
                                alert('Error: ' + err.message);
                            }
                        } else {
                            console.error('‚ùå window.activateISSChaseCamera is NOT a function!');
                            console.error('   Type:', typeof window.activateISSChaseCamera);
                            alert('ISS Chase Camera function not loaded yet. Wait a moment and try again.');
                        }
                    });

                    console.log('‚úÖ ISS Chase button event listener attached (INLINE)');
                } else {
                    console.error('‚ùå ISS Chase button not found in DOM');
                }
            }, 2000); // Wait 2 seconds to ensure DOM is ready
        });
    </script>
</body>
</html>
