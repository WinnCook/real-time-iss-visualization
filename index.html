<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time ISS tracking with beautiful 3D solar system visualization">

    <!-- FORCE NO CACHE - NUCLEAR OPTION -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>Real-Time ISS & Solar System Visualization</title>

    <!-- Styles -->
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/ui.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <h1>ğŸš€ ISS Tracker</h1>
            <div class="loading-spinner"></div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text">
                    <span id="progress-percent">0%</span>
                </div>
            </div>
            <p id="loading-status">Initializing solar system...</p>
        </div>
    </div>

    <!-- Main 3D Canvas Container -->
    <div id="canvas-container"></div>

    <!-- UI Overlay -->
    <div id="ui-overlay">
        <!-- Header with Title and FPS -->
        <div id="header">
            <h1>ğŸŒ Real-Time ISS Tracker</h1>
            <div id="fps-counter">FPS: --</div>
        </div>

        <!-- Control Panel -->
        <div id="control-panel" class="panel">
            <h3>Controls</h3>

            <!-- Time Speed Slider -->
            <div class="control-group">
                <label for="time-speed">Time Speed: <span id="speed-value">100000x</span></label>
                <input type="range" id="time-speed" min="1" max="500000" value="100000" step="1">
                <div class="preset-speeds">
                    <button data-speed="1">1x Real-Time</button>
                    <button data-speed="1000">1kx</button>
                    <button data-speed="10000">10kx</button>
                    <button data-speed="100000">100kx</button>
                    <button data-speed="500000">500kx</button>
                </div>
            </div>

            <!-- Play/Pause -->
            <div class="control-group">
                <button id="play-pause" class="btn-primary">â¸ Pause</button>
                <button id="reset-camera" class="btn-secondary">ğŸ¥ Reset Camera</button>
            </div>

            <!-- Real-Time View Button -->
            <div class="control-group">
                <button id="realtime-view-btn" class="btn-primary" style="width: 100%;">
                    ğŸŒ Real-Time View (Current Positions)
                </button>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
                    Shows actual planet positions right now
                </p>
            </div>

            <!-- Simulation Date/Time Display -->
            <div class="control-group">
                <label>Simulation Date:</label>
                <div id="simulation-date" style="font-size: 1rem; color: #fff; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; text-align: center;">
                    Loading...
                </div>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
                    Current date in the simulation
                </p>
            </div>

            <!-- Time Travel Slider -->
            <div class="control-group">
                <label for="time-travel-slider">Time Travel: <span id="time-travel-year">2025</span></label>
                <input type="range" id="time-travel-slider" min="1900" max="2100" value="2025" step="0.01">
                <div class="performance-markers">
                    <span>1900</span>
                    <span>2000</span>
                    <span>2100</span>
                </div>
                <button id="jump-to-date-btn" class="btn-secondary" style="width: 100%; margin-top: 0.5rem;">
                    ğŸ•°ï¸ Jump to Selected Date
                </button>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
                    Drag to select any date from 1900-2100
                </p>
            </div>

            <!-- Visual Style Switcher -->
            <div class="control-group">
                <label>Visual Style:</label>
                <div class="style-buttons">
                    <button data-style="realistic" class="style-btn active">ğŸŒ Realistic</button>
                    <button data-style="cartoon" class="style-btn">ğŸ¨ Cartoon</button>
                    <button data-style="neon" class="style-btn">âš¡ Neon</button>
                    <button data-style="minimalist" class="style-btn">â—¯ Minimal</button>
                </div>
            </div>

            <!-- Planet Size Mode -->
            <div class="control-group">
                <label>Planet Sizes:</label>
                <div class="size-mode-buttons">
                    <label class="size-mode-btn active">
                        <input type="radio" name="size-mode" value="enlarged" checked>
                        <span>ğŸ“ Enlarged (Visible)</span>
                    </label>
                    <label class="size-mode-btn">
                        <input type="radio" name="size-mode" value="real">
                        <span>ğŸ”¬ Real Proportions</span>
                    </label>
                </div>
                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-top: 0.5rem;">
                    Real mode shows accurate size ratios. Sun is huge, planets are small. Zoom in to see details!
                </p>
            </div>

            <!-- Performance Slider -->
            <div class="control-group">
                <label for="performance-slider">Performance: <span id="performance-value">Medium (50%)</span></label>
                <input type="range" id="performance-slider" min="0" max="100" value="50" step="1">
                <div class="performance-markers">
                    <span>ğŸŒ Ultra Low</span>
                    <span>âš¡ Balanced</span>
                    <span>âœ¨ Ultra High</span>
                </div>
                <p class="preset-description" id="preset-description">
                    Drag slider left for smoothness, right for quality
                </p>
            </div>

            <!-- Shooting Star Frequency -->
            <div class="control-group">
                <label for="meteor-frequency">Meteor Frequency: <span id="meteor-frequency-value">Low</span></label>
                <input type="range" id="meteor-frequency" min="0" max="100" value="20" step="1">
                <div class="performance-markers">
                    <span>Off</span>
                    <span>Moderate</span>
                    <span>ğŸŒ  Frequent</span>
                </div>
                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-top: 0.5rem;">
                    Control how often shooting stars appear (scales with time speed)
                </p>
            </div>

            <!-- Feature Toggles -->
            <div class="control-group">
                <label>Display:</label>
                <div class="toggles">
                    <label class="toggle">
                        <input type="checkbox" id="toggle-orbits" checked>
                        <span>Orbits</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-labels" checked>
                        <span>Labels</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-trails" checked>
                        <span>Trails</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-stars" checked>
                        <span>Stars</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-corona" checked>
                        <span>ğŸŒŸ Sun Corona</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-atmosphere" checked>
                        <span>ğŸŒ Atmosphere</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-lens-flare" checked>
                        <span>âœ¨ Lens Flare</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-asteroid-belt" checked>
                        <span>Asteroids</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-orbital-markers">
                        <span>ğŸ¯ Perihelion/Aphelion</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-sounds">
                        <span>ğŸ”Š Sounds</span>
                    </label>
                </div>
                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-top: 0.5rem;">
                    Visualization uses real NASA orbital data with elliptical paths and orbital inclinations
                </p>
            </div>
        </div>

        <!-- Info Panel -->
        <div id="info-panel" class="panel">
            <h3>ğŸ›°ï¸ ISS Status</h3>
            <div id="iss-info">
                <div class="info-row">
                    <span class="info-label">Position:</span>
                    <span id="iss-position">Loading...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Altitude:</span>
                    <span id="iss-altitude">-- km</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Velocity:</span>
                    <span id="iss-velocity">-- km/h</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Last Update:</span>
                    <span id="iss-update-time">--</span>
                </div>
            </div>

            <h3>ğŸ“ Selected Object</h3>
            <div class="object-selector">
                <label for="object-dropdown">Quick Select:</label>
                <select id="object-dropdown">
                    <option value="">-- Select Object --</option>
                    <option value="sun">â˜€ï¸ Sun</option>
                    <option value="mercury">â˜¿ï¸ Mercury</option>
                    <option value="venus">â™€ï¸ Venus</option>
                    <optgroup label="ğŸŒ Earth System">
                        <option value="earth">ğŸŒ Earth</option>
                        <option value="moon">ğŸŒ™ Moon</option>
                        <option value="iss">ğŸ›°ï¸ ISS</option>
                    </optgroup>
                    <option value="mars">â™‚ï¸ Mars</option>
                    <optgroup label="â™ƒ Jupiter System">
                        <option value="jupiter">â™ƒ Jupiter</option>
                        <option value="io">ğŸŒ‹ Io</option>
                        <option value="europa">â„ï¸ Europa</option>
                        <option value="ganymede">ğŸŒ‘ Ganymede</option>
                        <option value="callisto">ğŸŒ‘ Callisto</option>
                    </optgroup>
                    <optgroup label="â™„ Saturn System">
                        <option value="saturn">â™„ Saturn</option>
                        <option value="titan">ğŸŸ  Titan</option>
                        <option value="rhea">âšª Rhea</option>
                        <option value="iapetus">âš« Iapetus</option>
                    </optgroup>
                    <option value="uranus">â›¢ Uranus</option>
                    <option value="neptune">â™† Neptune</option>
                </select>
            </div>
            <div id="selected-info">
                <p>Click any object or use dropdown to see details</p>
            </div>
        </div>

        <!-- Help Button -->
        <button id="help-button" class="floating-btn" title="Help & Controls">
            â“
        </button>

        <!-- Screenshot Button -->
        <button id="screenshot-button" title="Take Screenshot (P)">
            ğŸ“¸
        </button>

        <!-- Share Button -->
        <button id="share-button" title="Share Current View">
            ğŸ”—
        </button>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>ğŸ® Controls & Help</h2>

            <h3>Camera Controls</h3>
            <ul>
                <li><strong>Left Click + Drag:</strong> Rotate camera</li>
                <li><strong>Right Click + Drag:</strong> Pan camera</li>
                <li><strong>Scroll Wheel:</strong> Zoom in/out</li>
                <li><strong>Touch:</strong> One finger rotate, two finger zoom/pan</li>
            </ul>

            <h3>Interactions</h3>
            <ul>
                <li><strong>Click Objects:</strong> Focus camera on planets or ISS</li>
                <li><strong>Time Speed:</strong> Adjust how fast time moves (1x to 50,000x)</li>
                <li><strong>Visual Styles:</strong> Switch between 4 different visual themes</li>
                <li><strong>Toggles:</strong> Show/hide orbits, labels, trails, and stars</li>
            </ul>

            <h3>Keyboard Shortcuts</h3>
            <ul>
                <li><strong>Space:</strong> Play/Pause</li>
                <li><strong>R:</strong> Reset Camera</li>
                <li><strong>H or ?:</strong> Toggle Help</li>
                <li><strong>F:</strong> Focus on Earth</li>
                <li><strong>I:</strong> Focus on ISS</li>
                <li><strong>O/L/T/S:</strong> Toggle Orbits/Labels/Trails/Stars</li>
                <li><strong>1-4:</strong> Switch Visual Styles</li>
                <li><strong>Arrow Keys:</strong> Adjust Time Speed</li>
            </ul>

            <h3>Tips</h3>
            <ul>
                <li>Try <strong>2000x speed</strong> to see Earth complete an orbit in ~7 minutes</li>
                <li>Use <strong>Neon style</strong> for dramatic orbital trails</li>
                <li>Click <strong>Earth</strong> and zoom in to see the ISS orbit</li>
                <li>At high speeds, the ISS becomes a ring around Earth</li>
            </ul>

            <h3>About</h3>
            <p>This visualization uses real-time ISS position data from Open Notify API, updated every 5 seconds. The solar system uses simplified orbital mechanics for performance.</p>

            <button id="restart-tutorial-btn" class="btn-primary" style="margin-top: 1rem; width: 100%;">
                ğŸ“ Restart Tutorial
            </button>
        </div>
    </div>

    <!-- VERSION 20250113004 - SWAPPED BUTTON VALUES -->

    <!-- Import Map for ES6 Modules -->
    <!-- Import map removed - all code uses global THREE from script tag -->

    <!-- Load Three.js from LOCAL FILES (r128 - Pinned Version) -->
    <script src="assets/js/three.min.js"></script>

    <!-- ONLY LOAD TRACKBALLCONTROLS - NO ORBITCONTROLS (conflict removed) -->
    <script src="assets/js/TrackballControls.js"></script>

    <!-- Load GLTFLoader for 3D models -->
    <script src="assets/js/GLTFLoader.js"></script>

    <!-- Verify Three.js loaded and make it globally available -->
    <script>
        console.log('ğŸš¨ğŸš¨ğŸš¨ VERIFICATION SCRIPT RUNNING - VERSION 20250113004 ğŸš¨ğŸš¨ğŸš¨');

        if (typeof THREE !== 'undefined') {
            window.THREE = THREE;
            console.log('âœ… Three.js library loaded (version:', THREE.REVISION, ')');

            // Verify TrackballControls loaded
            if (THREE.TrackballControls) {
                console.log('âœ…âœ…âœ… TrackballControls loaded - UNLIMITED ROTATION ENABLED!');
            } else {
                console.error('âŒâŒâŒ TrackballControls FAILED TO LOAD - rotation will be broken!');
            }

            // Verify GLTFLoader loaded
            if (THREE.GLTFLoader) {
                console.log('âœ… GLTFLoader loaded - 3D models ready!');
            } else {
                console.error('âŒ GLTFLoader failed to load');
            }
        } else {
            console.error('âŒ Failed to load Three.js from CDN');
            alert('Failed to load Three.js library. Please check your internet connection and refresh the page.');
        }
    </script>

    <!-- Main Application Entry Point (will load other modules as needed) -->
    <script type="module" src="src/main.js?v=20250113004"></script>
</body>
</html>
